#!/usr/bin/make -f
# Sample debian/rules that uses debhelper.
# GNU copyright 1997 to 1999 by Joey Hess.
#
# Copyright (c) 2010 Facundo Batista <facundo@taniquetil.com.ar>

PYVERS := $(shell pyversions -s -v)

build: build-stamp

build-stamp:
	dh_testdir
	python setup.py build
	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	python setup.py clean
	find . -name "*.pyc" -delete
	rm -rf build
	dh_clean build-stamp

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	python setup.py install --root=$(CURDIR)/debian/typuspocus --install-layout=deb

	# DIRTY! I didn't know how to make setuptools to install in /usr/share, 
	# so I'm moving it here and cleaning the other stuff
	mkdir -p $(CURDIR)/debian/typuspocus/usr/share/
	mkdir -p $(CURDIR)/debian/typuspocus/usr/games
	mv $(CURDIR)/debian/typuspocus/usr/lib/python2.6/dist-packages/typuspocus $(CURDIR)/debian/typuspocus/usr/share/
	rm -r $(CURDIR)/debian/typuspocus/usr/lib
	ln -s $(CURDIR)/debian/typuspocus/usr/share/typuspocus/game.py $(CURDIR)/debian/typuspocus/usr/games/typuspocus
	chmod 755 $(CURDIR)/debian/typuspocus/usr/share/typuspocus/game.py

	# put the copyright file by hand (maybe this should be done 
	# automatically in some other way?)
	mkdir -p $(CURDIR)/debian/typuspocus/usr/share/doc/typuspocus
	cp $(CURDIR)/debian/copyright $(CURDIR)/debian/typuspocus/usr/share/doc/typuspocus/
	cp $(CURDIR)/debian/changelog $(CURDIR)/debian/typuspocus/usr/share/doc/typuspocus/
	gzip -9 $(CURDIR)/debian/typuspocus/usr/share/doc/typuspocus/changelog


# Build architecture-independent files here.
binary-indep: build install
	dh_testdir 
	dh_testroot 
	dh_install -i
	dh_pysupport -i
	# Remove DejaVu files (the font is replaced by a link)
	rm -f debian/typospocus/usr/share/typospocus/escenario/DejaVu*.ttf
	dh_link -i
	dh_compress -i -X.py -X.ini -X.xml -Xtest
	dh_fixperms -i
	dh_installdeb -i
	dh_gencontrol -i 
	dh_md5sums -i
	dh_builddeb -i

binary-arch:

binary: binary-indep
.PHONY: build clean binary binary-indep binary-arch
